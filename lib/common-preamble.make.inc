DOCKER_HOST_IP_ADDR := $(shell echo `/sbin/ifconfig eth0 | grep -i mask | awk '{print $$2}'| cut -f2 -d:`)
CURRENT_USER := $(shell echo `whoami`)
CURRENT_USER_ID := $(shell echo `id -u`)
CURRENT_USER_GROUP_ID := $(shell echo `id -g`)
CURRENT_USER_HOME := $(HOME)
CURRENT_DIR_PATH := $(shell echo `pwd`)
CURRENT_DIR_NAME := $(shell basename `pwd`)

CONTAINER_NAME := $(CURRENT_DIR_NAME)
CONTAINER_DEFN_HOME := $(CURRENT_DIR_PATH)

CONTAINER_IS_RUNNING := $(shell docker ps --filter "name=$(CONTAINER_NAME)" --filter "status=running" --quiet)

CAF_HOME = $(shell realpath ../)
CAF_LIB = $(CAF_HOME)/lib
APPLIANCE_HOME = $(shell realpath $(CAF_HOME)/..)

DOCKER_NETWORK_NAME := appliance

CAF_CONF_FILE := $(CAF_HOME)/CAF.conf.jsonnet
APPLIANCE_CONF_FILE := $(APPLIANCE_HOME)/appliance.conf.jsonnet

# If the APPLIANCE_CONF_FILE exists, then the CAF is acting as a submodule to
# a "primary" appliance so let's let the rest of the Makefile act accordingly
ifneq ("$(wildcard $(APPLIANCE_CONF_FILE))","")
PRIMARY_CONF_FILE = $(APPLIANCE_CONF_FILE)
IS_SUBMODULE = 1
else
PRIMARY_CONF_FILE = $(CAF_CONF_FILE)
APPLIANCE_HOME = $(CAF_HOME)
IS_SUBMODULE = 0
endif

# This is the Makefile environment's JSonnet template file which is generated
# each time the make command is run. It's basically a convenience wrapper that
# makes the runtime environment available to the CONTAINER_DEFN_JSONNET file.
CONTAINER_CONF_JSONNET_TMPL := $(CAF_HOME)/lib/container.conf.tmpl.jsonnet
CONTAINER_CONF_GENERATED_FILE := container.conf.json

# This is the primary JSonnet configuration file, it creates all the container's
# definition and configuration files using Jsonnet -m (multi-file) strategy.
CONTAINER_DEFN_JSONNET := container.defn.jsonnet

# This file holds the list of files generated by the jsonnet --multi command
CONTAINER_DEFN_JSONNET_GENERATED_FILES_LIST := .container.defn.jsonnet_generated
